// --- CABEÇALHO (O que faltava) ---
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
// ----------------------------------
// Define o Cargo do Funcionário 
enum Cargo {
  ADMINISTRATIVO
  MEDICO
  ENFERMEIRO
}

// Modelo Central - O "Cadastro Único"
model Pessoa {
  id        Int      @id @default(autoincrement())
  nome      String  
  createdAt DateTime @default(now())

  // Uma Pessoa pode ter (ou não) um perfil de Funcionário
  funcionario  Funcionario?
  // Uma Pessoa pode ter (ou não) um perfil de Paciente
  paciente     Paciente?
}

// Modelo Funcionário (Especialização de Pessoa) 
model Funcionario {
  id             Int       @id @default(autoincrement())
  
  // Relação 1-para-1 com Pessoa
  pessoa         Pessoa    @relation(fields: [pessoaId], references: [id])
  pessoaId       Int       @unique
  
  cpf       String   @unique // Identificador principal 
  password  String   // Precisamos disso para o login 
  cargo     Cargo   @default(MEDICO) // Cargo do funcionário
  crm            String?   // Apenas para MEDICO
  especialidade  String?   // Especialidade médica (ex: Cardiologista, Pediatra, etc.)

  // Um funcionário (médico) pode ter vários agendamentos
  agendamentos   Agendamento[]
}


// Modelo Paciente (Especialização de Pessoa)
model Paciente {
  id             Int       @id @default(autoincrement())
  
  // Relação 1-para-1 com Pessoa
  pessoa         Pessoa    @relation(fields: [pessoaId], references: [id])
  pessoaId       Int       @unique
  
  cpf            String    @unique // CPF do paciente
  dataNascimento DateTime? // Data de nascimento
  sexo           String?   // M, F, Outro
  responsavelNome String?  // Nome do responsável (para menores)
  
  // Um paciente pode ter vários agendamentos
  agendamentos   Agendamento[]
}

model Agendamento {
  id          Int      @id @default(autoincrement())
  dataHora    DateTime
  status      String   // (ex: AGENDADO, REALIZADO, CANCELADO)
  tipoConsulta String   // (ex: CONSULTA, RETORNO, EXAME)
  especialidade String?  // Ex: Cardiologista, Pediatra, etc.    
  descricao   String?  // Detalhes adicionais    
  sexo      String?  // 
  idade    Int?     //
  responsavelNome String? 
  nomePaciente String?        // Mantido para compatibilidade
  
  funcionario Funcionario @relation(fields: [funcionarioId], references: [id])
  funcionarioId Int       // O médico responsável
  
  // Relação com Paciente (opcional, para manter compatibilidade)
  paciente   Paciente?   @relation(fields: [pacienteId], references: [id])
  pacienteId Int?        // ID do paciente cadastrado
}